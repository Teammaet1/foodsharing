<!DOCTYPE html>
<html>
    <head>
        <title>Foodsharing</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link href="../css/layout.css" rel="stylesheet" type="text/css" media="all">
    </head>
    <body style="background-image: url('../images/demo/backgrounds/1.jpg'); min-height: 100vh; max-height: auto; background-repeat: no-repeat; background-size: cover; background-position: center center; color: black; text-align: center; display: flex; flex-direction: column; justify-content: space-between; ">

        <div style="align-items: center" class="wrapper row2">
            <nav id="mainav" class="hoc clear">
                <ul class="clear">
                    <li><a href="../index.html">Главная</a></li>
                    <li><a >Участникам</a></li>
                    <li><a >Sidebar Right</a></li>
                    <li><a >Волонтерство</a></li>
                    <li><a >Справка</a></li>
                    <li class="active"><a id="authorize" href="../Page/volonterhome.html">Личный кабинет</a></li>
                </ul>
            </nav>
        </div>


        <div class="wrapper bgded">
            <div id="pageintro" class="hoc clear">
            </div>

            <div style="margin-bottom: 280px;" class="wrapper row3">
                <main class="hoc container clear">
                    <div class="center btmspace-50">
                        <h2 class="heading">ЗАКАЗ</h2>

                        <h3 class="heading" id="shop"></h3>

                        <table class="heading" id="productItem">
                        </table>

                        <button class="custom-btn btn-3" type="submit" id="submit">Выполнено</button>
                    </div>

                   
                    <div class="clear"></div>
                </main>
            </div>


        </div>

        <script>
            async function GetOrder(id) {
                const response = await fetch("/order/" + id, {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });
                if (response.ok === true) {
                    const order = await response.json();
                    let table = document.getElementById("productItem");
                    let shop = document.getElementById("shop");
                    shop.append(order.shop.address)
                    order.products.forEach(product => {
                        const tr = document.createElement("tr");
                        tr.append(product.product.name + ": " + product.count);
                        table.append(tr);
                    })
                }
            }


            async function Done(id) {
                const response = await fetch("/order/done/" + id, {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });
                if (response.ok === true) {
                    document.getElementById("submit").remove();
                }
            }

            document.getElementById("submit").addEventListener("click", e => {
                e.preventDefault();
                Done(id);
            });

            var id = window.location.href.split("?")[1].split("=")[1];




            GetOrder(id);
        </script>
    </body>
</html>
