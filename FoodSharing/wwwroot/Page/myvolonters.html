<!DOCTYPE html>

<head>
<title>Foodsharing</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="../css/layout.css" rel="stylesheet" type="text/css" media="all">
</head>
<body style="background-image: url('../images/demo/backgrounds/1.jpg'); min-height: 100vh; max-height: auto; background-repeat: no-repeat; background-size: cover; background-position: center center; color: black; text-align: center; display: flex; flex-direction: column; justify-content: space-between; ">

<div style="align-items: center"class="wrapper row2">
  <nav id="mainav" class="hoc clear">
    <ul class="clear">
      <li><a href="../index.html">Главная</a></li>
      <li><a >Участникам</a></li>
      <li><a >Sidebar Right</a></li>
      <li ><a >Волонтерство</a></li>
      <li><a >Справка</a></li>
      <li class="active"><a id="authorize" href="../Page/tutor-lk.html">Личный кабинет</a></li>
    </ul>
  </nav>
</div>


<div class="wrapper bgded" >
  <div id="pageintro" class="hoc clear">
</div>

<div style="margin-bottom: 280px;" class="wrapper row3">
  <main class="hoc container clear">
      <div class="center btmspace-50">
          <h2 class="heading">ВОЛОНТЕРЫ</h2>

          <table id="volontersItem">
          </table>
      </div>

    <div class="clear"></div>
  </main>
</div>

    <script>

        async function GetVolonters() {
            const response = await fetch("https://localhost:7285/user/volonters", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const volonters = await response.json();
                let table = document.getElementById("volontersItem");
                volonters.forEach(volonter => {
                    const tr = document.createElement("tr");
                    tr.append(volonter.fio);
                    table.append(tr);
                })
            }
        }

        async function Authorize() {
            const response = await fetch("https://localhost:7285/Account/Authorize", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === false) {
                window.location.href = '/index.html';
            }
            else
                Role();
        }

        async function Role() {
            const response = await fetch("https://localhost:7285/Account/AuthorizeRole", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const resStr = await response.json();
                let exit = true
                resStr.forEach(str => {
                    if (str === "tutor") {
                        let a = document.getElementById("authorize");
                        a.setAttribute('href', '/Page/tutor-lk.html');
                        exit = false;
                    }
                })
                if (exit)
                    window.location.href = '/index.html';
            }

        }



        Authorize();
        GetVolonters();
    </script>
</body>
</html>
